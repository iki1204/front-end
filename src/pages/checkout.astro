---
import BaseLayout from "../layouts/Layout.astro";
import Container from "../components/Container.astro";
import { getGlobalData } from "../lib/api";

const global = await getGlobalData();
---

<BaseLayout global={global}>
  <Container>
    <section class="py-12 lg:py-16">
      <header class="mb-10 text-center lg:text-left">
        <p class="text-sm font-semibold uppercase tracking-wide text-primary">Checkout</p>
        <h1 class="mt-2 text-3xl font-bold text-zinc-900 dark:text-white">Confirma tu pedido</h1>
        <p class="mt-3 text-sm text-zinc-500 dark:text-zinc-400">
          Revisa los artículos añadidos, ajusta las cantidades y envíanos tu solicitud de compra.
        </p>
      </header>

      <div class="grid gap-8 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]">
        <section
          data-checkout-root
          class="space-y-6 rounded-3xl border border-zinc-200 bg-white p-6 shadow-sm dark:border-zinc-800 dark:bg-zinc-900"
        >
          <div class="flex items-center justify-between gap-4">
            <h2 class="text-xl font-semibold text-zinc-900 dark:text-white">Productos en tu carrito</h2>
            <a
              href="/tienda"
              class="text-sm font-semibold text-primary transition hover:underline"
            >
              Seguir comprando
            </a>
          </div>
          <p data-checkout-empty class="text-sm text-zinc-500 dark:text-zinc-400">
            Tu carrito está vacío por ahora. Vuelve a la tienda para añadir productos.
          </p>
          <ul data-checkout-list class="hidden flex flex-col gap-4"></ul>
        </section>

        <aside
          class="space-y-6 rounded-3xl border border-zinc-200 bg-white p-6 shadow-sm dark:border-zinc-800 dark:bg-zinc-900"
        >
          <div>
            <h2 class="text-xl font-semibold text-zinc-900 dark:text-white">Resumen</h2>
            <p class="mt-2 text-sm text-zinc-500 dark:text-zinc-400">
              Este total es referencial. Nuestro equipo se pondrá en contacto para coordinar la entrega y el pago.
            </p>
          </div>
          <dl class="space-y-3 text-sm">
            <div class="flex items-center justify-between text-zinc-600 dark:text-zinc-300">
              <dt>Artículos</dt>
              <dd data-checkout-count>0 artículos</dd>
            </div>
            <div class="flex items-center justify-between text-zinc-900 dark:text-white font-semibold">
              <dt>Subtotal estimado</dt>
              <dd data-checkout-subtotal>$0.00</dd>
            </div>
          </dl>
          <div class="space-y-3">
            <button
              type="button"
              data-checkout-proceed
              class="w-full rounded-full bg-primary px-5 py-3 text-sm font-semibold text-white transition hover:brightness-110 disabled:cursor-not-allowed disabled:opacity-60"
              disabled
            >
              Solicitar mi pedido
            </button>
            <button
              type="button"
              data-checkout-clear
              class="w-full rounded-full border border-zinc-200 px-5 py-3 text-sm font-semibold text-zinc-600 transition hover:border-zinc-300 hover:text-zinc-900 dark:border-zinc-700 dark:text-zinc-300 dark:hover:border-zinc-600"
            >
              Vaciar carrito
            </button>
          </div>
          <div class="rounded-2xl bg-zinc-100 p-4 text-xs text-zinc-600 dark:bg-zinc-800 dark:text-zinc-300">
            <p class="font-semibold text-zinc-700 dark:text-white">¿Necesitas ayuda?</p>
            <p class="mt-1">
              Escríbenos por correo o WhatsApp y te asistiremos con el proceso de compra.
            </p>
          </div>
        </aside>
      </div>
    </section>
  </Container>
</BaseLayout>

<script type="module">
  import { initCheckoutPage } from "../lib/carritoWidget.ts";

  const setup = () => {
    initCheckoutPage();
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setup, { once: true });
  } else {
    setup();
  }

  document.addEventListener("astro:page-load", setup);
  document.addEventListener(
    "astro:before-swap",
    () => {
      document.removeEventListener("astro:page-load", setup);
    },
    { once: true },
  );
</script>