---
const { buttonVariant = "primary", floating = false, class: customClass = "" } = Astro.props;
const isOutline = buttonVariant === "outline";
const buttonBaseClasses = isOutline
  ? "border border-zinc-200 bg-primary/5 text-zinc-700 hover:border-primary hover:text-primary dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100"
  : "bg-primary text-white hover:brightness-110";
const floatingButtonClasses =
  "relative flex h-14 w-14 items-center justify-center rounded-full bg-primary text-white shadow-2xl shadow-primary/40 transition hover:scale-105 hover:brightness-110 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary";
const badgeClasses = floating
  ? "absolute -top-1.5 -right-1.5 inline-flex h-6 min-w-[1.5rem] items-center justify-center rounded-full bg-white text-xs font-bold text-primary shadow-lg"
  : `inline-flex h-6 min-w-[1.5rem] items-center justify-center rounded-full px-2 text-xs font-bold ${
      isOutline ? "bg-white/10 text-white" : "bg-white/20 text-white"
    }`;
const panelPositionClasses = floating ? "bottom-[calc(100%+0.35rem)] right-0" : "right-0 mt-4";
---

<div
  data-auth-visible="authenticated"
  class:list={[
    floating ? "fixed bottom-6 right-6 z-50" : "relative",
    "group/cart-widget",
    customClass,
  ]}
  data-cart-widget
  data-hover-open={floating ? "true" : undefined}
>
  <button
    type="button"
    data-cart-toggle
    aria-expanded="false"
    aria-controls="miniCartPanel"
    aria-label={floating ? "Abrir carrito flotante" : undefined}
    class:list={[
      floating
        ? floatingButtonClasses
        : "group flex items-center gap-1 rounded-full px-4 py-2 text-sm font-semibold transition focus:outline-none focus:ring-2 focus:ring-primary/60",
      floating ? "" : buttonBaseClasses,
    ]}
  >
    <span aria-hidden="true" class={floating ? "text-xl" : "text-lg"}>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        width="24"
        height="24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.8"
        stroke-linecap="round"
        stroke-linejoin="round"
      >

        <path d="M4 5h2.2a1 1 0 0 1 .97.75L8 8.5" />

        <path d="M8 8.5h11l-1.2 6.5H9.2L8 8.5Z" />

        <circle cx="10" cy="18.5" r="1.3" />
        <circle cx="17" cy="18.5" r="1.3" />
      </svg>
    </span>
    <span class:list={[floating ? "sr-only" : "hidden sm:inline"]}>Mi carrito</span>
    <span data-cart-count class={badgeClasses}>0</span>
  </button>
  <div
    id="miniCartPanel"
    data-cart-panel
    class:list={[
      "hidden absolute z-40 w-[22rem] rounded-3xl border border-zinc-200 bg-white p-6 shadow-2xl dark:border-zinc-800 dark:bg-zinc-900",
      panelPositionClasses,
      floating ? "drop-shadow-2xl" : "",
    ]}
  >
    <div class="mb-4 flex items-center justify-between gap-2">
      <div>
        <h2 class="text-lg font-semibold text-zinc-900 dark:text-white">Tu carrito</h2>
        <p class="text-xs text-zinc-500 dark:text-zinc-400">
          Revisa los productos añadidos y continúa al checkout cuando estés listo.
        </p>
      </div>
      <button
        type="button"
        data-cart-close
        class="rounded-full bg-zinc-100 px-2 py-1 text-sm text-zinc-500 transition hover:bg-zinc-200 hover:text-zinc-700 dark:bg-zinc-800 dark:text-zinc-300 dark:hover:bg-zinc-700"
        aria-label="Cerrar carrito"
      >
        ✕
      </button>
    </div>
    <div data-cart-empty class="text-sm text-zinc-500 dark:text-zinc-400">
      Aún no has añadido productos.
    </div>
    <ul data-cart-list class="hidden max-h-72 space-y-4 overflow-y-auto pr-2"></ul>
    <div data-cart-footer class="mt-4 hidden border-t border-zinc-200 pt-4 dark:border-zinc-800">
      <div class="flex items-center justify-between text-sm font-semibold text-zinc-900 dark:text-white">
        <span>Total</span>
        <span data-cart-total>$0.00</span>
      </div>
      <div class="mt-4 flex flex-col gap-2">
        <a
          href="/checkout"
          data-cart-checkout
          class="inline-flex items-center justify-center rounded-full bg-primary px-4 py-2 text-sm font-semibold text-white transition hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-primary/60"
        >
          Ir al checkout
        </a>
        <button
          type="button"
          data-cart-clear
          class="inline-flex items-center justify-center rounded-full border border-zinc-200 px-4 py-2 text-sm font-semibold text-zinc-600 transition hover:border-zinc-300 hover:text-zinc-900 dark:border-zinc-700 dark:text-zinc-300 dark:hover:border-zinc-600"
        >
          Vaciar carrito
        </button>
      </div>
    </div>
  </div>
</div>